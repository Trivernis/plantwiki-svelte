version: 1
when:
  - event: [tag]
    branch:
      - ${CI_REPO_DEFAULT_BRANCH}
steps:
  build:
    image: plugins/docker-buildx
    secrets: [forgejo_token]
    settings:
      dockerfile: Containerfile
      tag: ${CI_COMMIT_TAG##v}
      repo: git.trivernis.net/trivernis/plantwiki
      registry: git.trivernis.net
      platforms: linux/amd64,linux/arm64/v8
      username: woodpeckerbot
      password:
        from_secret: forgejo_token
    
